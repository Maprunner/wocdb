// Version 0.6.0 2022-07-15T14:28:10+0100;
var wocdb=function(){"use strict";return{init:function(){var t,e,i;return wocdb.router=new wocdb.WocdbRouter,wocdb.utils.hijackLinks(),wocdb.countries=new wocdb.Countries(wocdb.config.countrydata),wocdb.dispatcher=_.clone(Backbone.Events),wocdb.races=new wocdb.Races,wocdb.wocs=new wocdb.Wocs,wocdb.raceResult=new wocdb.RaceResult,wocdb.person=new wocdb.Person,wocdb.runners=new wocdb.Runners,wocdb.bestlist=new wocdb.BestList,wocdb.medals=new wocdb.Medals,wocdb.activeWOC=new wocdb.ActiveWOC,wocdb.masterView=new wocdb.MasterView,wocdb.activeWOCView=new wocdb.ActiveWOCView({model:wocdb.activeWOC}),wocdb.activeResultView=new wocdb.RaceResultView({collection:wocdb.raceResult}),wocdb.activeResultHeaderView=new wocdb.RaceResultHeaderView({collection:wocdb.raceResult}),wocdb.raceMenuView=new wocdb.RaceMenuView({model:wocdb.activeWOC}),wocdb.runnersView=new wocdb.RunnersView({collection:wocdb.runners}),wocdb.bestView=new wocdb.BestView({collection:wocdb.bestlist}),wocdb.medalView=new wocdb.MedalsView({collection:wocdb.medals}),wocdb.personView=new wocdb.PersonView({collection:wocdb.person}),wocdb.wocDbView=new wocdb.WOCDBView({collection:wocdb.wocs}),Backbone.history.start({pushState:!0,root:"/wocdb",silent:!0}),wocdb.config.bootstrapRaceResult?(wocdb.dispatcher.trigger("display:page","single-woc-page"),e=wocdb.utils.getType(parseInt(wocdb.config.bootstrapRaceResult[0].wocid,10)),i=parseInt(wocdb.config.bootstrapRaceResult[0].year,10),t=parseInt(wocdb.config.bootstrapRaceResult[0].raceid,10),void wocdb.dispatcher.trigger("startup:race",{type:e,year:i,raceid:t})):wocdb.config.bootstrapPerson?void(wocdb.config.bootstrapPerson.length&&(wocdb.dispatcher.trigger("display:page","person-page"),e=wocdb.config.bootstrapPerson[0].plainname,wocdb.dispatcher.trigger("startup:person",e))):wocdb.config.bootstrapRunners?(wocdb.dispatcher.trigger("display:page","country-page"),i=parseInt(wocdb.config.bootstrapRunners[0].country,10),void wocdb.dispatcher.trigger("startup:runners",{type:"person",country:i})):wocdb.config.bootstrapBestList?(wocdb.dispatcher.trigger("display:page","best-page"),void wocdb.dispatcher.trigger("startup:best")):wocdb.config.bootstrapMedals?(wocdb.dispatcher.trigger("display:page","medal-page"),void wocdb.dispatcher.trigger("startup:medal")):void wocdb.dispatcher.trigger("display:page","all-wocs-page")}}}((window,window.jQuery));!function(){"use strict";wocdb.ActiveWOC=Backbone.Model.extend({initialize:function(){wocdb.dispatcher.on("change:activeWOC",this.setActiveWOC,this)},setActiveWOC:function(t){this.set(t)}})}(),function(){"use strict";wocdb.Woc=Backbone.Model.extend({initialize:function(){this.attributes.type="W"===this.attributes.type?"WOC":"JWOC",this.attributes.raceids=this.attributes.raceids.split(",").map(function(t){return parseInt(t,10)}),this.attributes.classes=this.attributes.classes.split(","),this.attributes.races=this.attributes.races.split(","),this.attributes.links=this.attributes.links.split(",")}})}(),function(){"use strict";wocdb.Race=Backbone.Model.extend({initialize:function(){this.set("raceLowerCase",this.attributes.race.toLowerCase()),this.set("genderLowerCase",this.attributes.gender.toLowerCase())}})}(),function(){"use strict";wocdb.Result=Backbone.Model.extend({initialize:function(){this.attributes.flag=wocdb.countries.getFlagFile(this.attributes.country),this.attributes.venue=wocdb.utils.getVenue(this.attributes.wocid),this.attributes.numericPosition=this.attributes.position,0<this.attributes.final&&this.attributes.position<4&&(this.attributes.position='<img src="'+wocdb.config.url+"img/"+this.attributes.position+'.svg">'),this.attributes.percentdown=this.attributes.percentdown?parseFloat(this.attributes.percentdown).toFixed(1):"",this.attributes.gender=this.attributes.class}})}(),function(){"use strict";wocdb.Wocs=Backbone.Collection.extend({initialize:function(){this.activeWOCIndex=null,wocdb.dispatcher.on("click:showWOCID",this.setActiveWOCID,this),wocdb.dispatcher.on("click:showNextWOC",this.showNextWOC,this),wocdb.dispatcher.on("click:showPreviousWOC",this.showPreviousWOC,this),wocdb.dispatcher.on("startup:race",this.setActiveWOCAtStart,this),this.reset(wocdb.config.bootstrapWocs),this.createRaceCollection()},model:wocdb.Woc,setActiveWOCID:function(t){var e=this.findWhere({id:t.wocid});this.activeWocIndex=this.indexOf(e),(e=this.models[this.activeWocIndex].attributes).startUpRaceID=t.raceid,wocdb.dispatcher.trigger("change:activeWOC",e)},setActiveWOCAtStart:function(t){var e=this.findWhere({type:t.type,year:t.year});this.activeWocIndex=this.indexOf(e),(e=this.models[this.activeWocIndex].attributes).startUpRaceID=t.raceid,wocdb.dispatcher.trigger("change:activeWOC",e)},setActiveWOCIndex:function(t){this.activeWOCIndex=t,t=this.models[t].attributes,wocdb.dispatcher.trigger("change:activeWOC",t)},showPreviousWOC:function(){var t=this.activeWOCIndex+1;t>=this.models.length&&(t=0),this.setActiveWOCIndex(t)},showNextWOC:function(){var t=this.activeWOCIndex-1;t<0&&(t=this.models.length-1),this.setActiveWOCIndex(t)},createRaceCollection:function(){var t,e,i,s;for(wocdb.races.reset(),i=0;i<this.models.length;i+=1)for(e=this.models[i].attributes,s=0;s<e.raceids.length;s+=1)t={year:e.year,type:e.type,wocid:e.id,gender:e.classes[s],raceid:e.raceids[s],race:e.races[s],link:e.links[s]},wocdb.races.add(t)}})}(),function(){"use strict";wocdb.Races=Backbone.Collection.extend({model:wocdb.Race,getRaceInfo:function(t){return this.findWhere({raceid:t}).attributes},getRaceID:function(t,e,i,s){t=this.findWhere({type:t,year:parseInt(e,10),genderLowerCase:i,raceLowerCase:s});return t?t.attributes.raceid:0}})}(),function(){"use strict";wocdb.RaceResult=Backbone.Collection.extend({initialize:function(){wocdb.dispatcher.on("change:activeWOC",this.setRaceAtWOC,this),wocdb.dispatcher.on("click:showNextRaceAtWOC",this.getNextRaceAtWOC,this),wocdb.dispatcher.on("click:showPreviousRaceAtWOC",this.getPreviousRaceAtWOC,this),this.reset(wocdb.config.bootstrapRaceResult),this.listenTo(this,"update",this.announceNewRaceID),this.raceIndex=null,this.active={}},url:function(){return wocdb.config.url+this.active.type.toLowerCase()+"/"+this.active.year+"/"+this.active.classes[this.raceIndex].toLowerCase()+"/"+this.active.races[this.raceIndex].toLowerCase()},model:wocdb.Result,announceNewRaceID:function(){wocdb.router.navigate(this.active.type.toLowerCase()+"/"+this.active.year+"/"+this.active.classes[this.raceIndex].toLowerCase()+"/"+this.active.races[this.raceIndex].toLowerCase()),wocdb.dispatcher.trigger("change:raceid",this.active.raceids[this.raceIndex])},setRaceAtWOC:function(t){this.raceIndex=0,(this.active=t).startUpRaceID&&(this.raceIndex=_.indexOf(t.raceids,t.startUpRaceID),-1===this.raceIndex&&(this.raceIndex=0),this.announceNewRaceID()),0<this.length&&this.models[0].raceid===this.active.raceids[this.raceIndex]||this.loadRace()},getPreviousRaceAtWOC:function(){--this.raceIndex,this.raceIndex<0&&(this.raceIndex=this.active.races.length-1),this.loadRace()},getNextRaceAtWOC:function(){this.raceIndex+=1,this.raceIndex>=this.active.races.length&&(this.raceIndex=0),this.loadRace()},getResultByRaceID:function(t){this.raceIndex=_.indexOf(this.active.raceids,t),-1===this.raceIndex&&(this.raceIndex=0),this.loadRace()},loadRace:function(){this.reset(),this.fetch()}})}(),function(){"use strict";wocdb.ActiveWOCView=Backbone.View.extend({el:"#woc-summary-table",events:{"click #next-woc":"showNextWOC","click #prev-woc":"showPreviousWOC"},summaryTemplate:_.template($("#woc-summary-tmpl").html()),initialize:function(){this.listenTo(this.model,"change",this.render)},showNextWOC:function(){wocdb.dispatcher.trigger("click:showNextWOC")},showPreviousWOC:function(){wocdb.dispatcher.trigger("click:showPreviousWOC")},render:function(){return this.$el.html(this.summaryTemplate(this.model.attributes)),this}})}(),function(){"use strict";wocdb.WOCDBView=Backbone.View.extend({el:"#all-wocs-page",events:{"click #wocs-table tbody tr":"selectWOC"},initialize:function(){this.listenTo(this.collection,"reset",this.render),this.render()},render:function(){this.wocsTable=$("#wocs-table").DataTable({data:this.collection.models,columns:[{data:function(t){return t.get("id")},visible:!1},{data:function(t){return t.get("year")},title:"Year"},{data:function(t){return t.get("type")},title:"Type"},{data:function(t){return t.get("country")},title:"Country"},{data:function(t){return t.get("location")},title:"Location"},{data:function(t){return t.get("dates")},title:"Dates"},{data:function(t){return t.get("countries")},title:"Countries"},{data:function(t){return t.get("runners")},title:"Runners"}],createdRow:function(t,e,i){$(t).attr("id",i)},lengthMenu:[[10,20,-1],[10,20,"All"]],order:[[1,"desc"],[2,"desc"]],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[1,2,6,7]}]})},selectWOC:function(t){wocdb.dispatcher.trigger("display:page","single-woc-page"),t=parseInt(t.currentTarget.id,10),this.collection.setActiveWOCIndex(t)}})}(),function(){"use strict";wocdb.ResultView=Backbone.View.extend({model:wocdb.Result,tagName:"tr",template:_.template($("#race-result-tmpl").html()),render:function(){return this.$el.html(this.template(this.model.attributes)).attr("plainname",this.model.attributes.plainname),this}})}(),function(){"use strict";wocdb.utils={getVenue:function(t){t=wocdb.wocs.findWhere({id:parseInt(t,10)});return t?t.attributes.country:""},getRaceLink:function(t){t=wocdb.races.findWhere({raceid:parseInt(t,10)});return t?t.attributes.link:""},capitalise:function(t){return t?t[0].toUpperCase()+t.substring(1):""},getType:function(t){return parseInt(t,10)<1e3?"WOC":"JWOC"},getGroupByDropdown:function(t){t=_.reduce([{text:"By person",value:"person"},{text:"By country",value:"country"}],this.createGroupByDropdownHTML,t);return wocdb.countries.getCountriesDropdown(t)},createGroupByDropdownHTML:function(t,e){return t+"<li country='"+e.value+"'><a>"+e.text+"</a></li>"},getTypesDropdown:function(t){return _.reduce([{text:"WOC",value:"woc"},{text:"JWOC",value:"jwoc"}],this.createTypeDropdownHTML,t)},createTypeDropdownHTML:function(t,e){return t+"<li type='"+e.value+"'><a>"+e.text+"</a></li>"},getClassesDropdown:function(t){return _.reduce([{text:"Men",value:"men"},{text:"Women",value:"women"},{text:"Mixed",value:"mixed"}],this.createClassDropdownHTML,t)},createClassDropdownHTML:function(t,e){return t+"<li class='"+e.value+"'><a>"+e.text+"</a></li>"},getRacesDropdown:function(t){return _.reduce([{text:"Long",value:"long"},{text:"Middle",value:"middle"},{text:"Sprint",value:"sprint"},{text:"Relay",value:"relay"},{text:"Sprint Relay",value:"sprintrelay"},{text:"KOSprint",value:"kosprint"}],this.createRaceDropdownHTML,t)},createRaceDropdownHTML:function(t,e){return t+"<li race='"+e.value+"'><a>"+e.text+"</a></li>"},hijackLinks:function(){$(document).on("click","a[href]:not([data-bypass])",function(t){var e={prop:$(this).prop("href"),attr:$(this).attr("href")},i=location.protocol+"//"+location.host+"/wocdb";e.prop.slice(0,i.length)===i&&(t.preventDefault(),wocdb.router.navigate(e.attr,!0))})}}}(),function(){"use strict";wocdb.PersonView=Backbone.View.extend({el:"#person-page",events:{"click #person-table tbody tr":"selectWOCRace","click #name-submit":"getNewPerson"},headerTemplate:_.template($("#person-header-tmpl").html()),initialize:function(){this.listenTo(this.collection,"update",this.render),wocdb.dispatcher.on("startup:person",this.render,this),this.nameSearch=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:wocdb.config.url+"namesearch/%QUERY",wildcard:"%QUERY"}}),$("#suggest-name .typeahead").typeahead({highlight:!0},{display:"name",limit:20,source:this.nameSearch}).bind("typeahead:selected",function(t,e){$(this).attr("plainname",e.plainname)})},render:function(){this.personTable&&this.personTable.destroy(),this.$("#person-header").empty().html(this.headerTemplate(this.collection.models[0].attributes)),this.personTable=$("#person-table").empty().DataTable({data:this.collection.models,paging:!1,info:!1,columns:[{data:function(t){return t.get("year")},title:"Year"},{data:function(t){return wocdb.utils.getType(t.get("wocid"))},title:"Event"},{data:function(t){return t.get("venue")},title:"Venue"},{data:function(t){return t.get("class")},title:"Class"},{data:function(t){return t.get("race")},title:"Race"},{data:function(t){return t.get("numericPosition")},title:"Place",render:function(t,e,i){if("display"===e){if(t<4&&0<i.attributes.final)return'<img src="'+wocdb.config.url+"img/"+t+'.svg">';if(999===t)return"-";if(998===t)return"nc"}return t}},{data:function(t){return t.get("name")},title:"Name",width:"20%"},{data:function(t){return t.get("country")},title:"Country"},{data:function(t){return"<img src='"+t.get("flag")+"'>"},title:""},{data:{_:function(t){return t.get("time")},sort:function(t){return parseInt(t.get("seconds"),10)}},title:"Time",type:"num"}],createdRow:function(t,e){$(t).attr("wocid",e.attributes.wocid).attr("raceid",e.attributes.raceid)},order:[[0,"desc"],[1,"desc"]],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[0,1,5,7,9]}]})},getNewPerson:function(){var t=$(".typeahead.tt-input").attr("plainname");wocdb.person.getPerson(t)},selectWOCRace:function(t){var e;wocdb.dispatcher.trigger("display:page","single-woc-page"),e=parseInt($(t.currentTarget).attr("wocid"),10),t=parseInt($(t.currentTarget).attr("raceid"),10),wocdb.dispatcher.trigger("click:showWOCID",{wocid:e,raceid:t})}})}(),function(){"use strict";wocdb.RaceResultView=Backbone.View.extend({el:"#result-table",events:{"click tr":"selectPerson"},initialize:function(){this.listenTo(this.collection,"update",this.render),wocdb.dispatcher.on("startup:race",this.render,this)},render:function(){var t,e;if(this.$el.empty().html("<thead><th class='center-text'>Pos</th><th>Name</th><th>Country</th><th></th><th class='center-text'>Time</th><th class='center-text'>% down</th></thead>"),0<this.collection.length)for(t=0;t<this.collection.length;t+=1)e=new wocdb.ResultView({model:this.collection.at(t)}),this.$el.append(e.$el),e.render();else this.$el.append("No records found.");return this.delegateEvents(),this},selectPerson:function(t){wocdb.dispatcher.trigger("display:page","person-page"),t=$(t.currentTarget).attr("plainname"),wocdb.dispatcher.trigger("change:person",t)}})}(),function(){"use strict";wocdb.RaceResultHeaderView=Backbone.View.extend({el:"#race-result-header",events:{"click #next-race-at-woc":"showNextRace","click #prev-race-at-woc":"showPreviousRace","click #map-link":"showMap"},initialize:function(){this.raceID=null,this.listenTo(this.collection,"update",this.render),wocdb.dispatcher.on("startup:race",this.render,this),wocdb.dispatcher.on("change:raceid",this.setRaceID,this)},template:_.template($("#race-header-tmpl").html()),render:function(){var t;return this.collection.length&&((t=this.collection.models[0].attributes).link=wocdb.utils.getRaceLink(this.raceID),document.title=wocdb.utils.getType(t.wocid)+" "+t.year+" "+t.class+" "+t.race,$("#race-result-header-text").html(this.template(t))),this},setRaceID:function(t){this.raceID=t},showMap:function(){window.open(wocdb.utils.getRaceLink(this.raceID))},showNextRace:function(){wocdb.dispatcher.trigger("click:showNextRaceAtWOC")},showPreviousRace:function(){wocdb.dispatcher.trigger("click:showPreviousRaceAtWOC")}})}(),function(){"use strict";wocdb.RaceMenuView=Backbone.View.extend({el:"#race-nav-list",events:{},menuTemplate:_.template($("#race-menu-tmpl").html()),initialize:function(){this.listenTo(this.model,"change",this.render),wocdb.dispatcher.on("change:raceid",this.setNewRaceID,this),this.oldRaceID=null},render:function(){var t,e=this.model.attributes;for(this.$el.empty(),t=0;t<e.races.length;t+=1)this.$el.append(this.menuTemplate({type:e.type,year:e.year,gender:e.classes[t],race:e.races[t],raceid:e.raceids[t]}));return this.oldRaceID&&this.$("#"+this.oldRaceID).addClass("active"),this},setNewRaceID:function(t){this.oldRaceID&&this.$("#"+this.oldRaceID).removeClass("active"),this.$("#"+t).addClass("active"),this.oldRaceID=t}})}(),function(){"use strict";wocdb.WocdbRouter=Backbone.Router.extend({routes:{wocdb:"showAllWocs","woc/:year/:gender/:race":"getWOCResult","jwoc/:year/:gender/:race":"getJWOCResult","person/:person":"getPerson","runners/:type/:country":"getRunnersByCountry","medals/:group/:type/:class/:race":"getMedals","best/:country/:type/:class/:race":"getBestResults",person:"nameSearch","*other":"showAllWocs"},nameSearch:function(){wocdb.person.searchName(),wocdb.dispatcher.trigger("display:page","person-page")},getBestResults:function(t,e,i,s){wocdb.bestlist.getBest({country:t,type:e,gender:i,race:s}),wocdb.dispatcher.trigger("display:page","best-page")},getMedals:function(t,e,i,s){wocdb.medals.getMedals({group:t,type:e,gender:i,race:s}),wocdb.dispatcher.trigger("display:page","medal-page")},getPerson:function(t){wocdb.person.getPerson(t),wocdb.dispatcher.trigger("display:page","person-page")},getRunnersByCountry:function(t,e){wocdb.runners.getRunnersByCountry(t,e),wocdb.dispatcher.trigger("display:page","country-page")},getWOCResult:function(t,e,i){this.getResult("WOC",t,e,i)},getJWOCResult:function(t,e,i){this.getResult("JWOC",t,e,i)},getResult:function(t,e,i,s){wocdb.dispatcher.trigger("display:page","single-woc-page"),t=wocdb.races.getRaceID(t,e,i,s),wocdb.raceResult.getResultByRaceID(t)},showAllWocs:function(){document.title="Maprunner WOC Database",wocdb.dispatcher.trigger("display:page","all-wocs-page")}})}(),function(){"use strict";wocdb.Person=Backbone.Collection.extend({initialize:function(){wocdb.dispatcher.on("change:person",this.getPerson,this),this.reset(wocdb.config.bootstrapPerson),0<this.length?this.personid=this.models[0].personid:this.personid=null},url:function(){return wocdb.config.url+"person/"+this.personid},model:wocdb.Result,searchName:function(){this.personid=null},getPerson:function(t){this.personid=t,wocdb.router.navigate("person/"+this.personid),this.fetch()}})}(),function(){"use strict";wocdb.MasterView=Backbone.View.extend({el:"#wocdb-container",pages:["all-wocs-page","single-woc-page","person-page","country-page","best-page","medal-page"],initialize:function(){wocdb.dispatcher.on("display:page",this.setPageVisibility,this)},setPageVisibility:function(t){_.each(this.pages,this.setDisplay,t)},setDisplay:function(t){var e=t===this?"block":"none";$("#"+t).css("display",e)}})}(),function(){"use strict";wocdb.Runner=Backbone.Model.extend({initialize:function(){this.attributes.flag=wocdb.countries.getFlagFile(this.attributes.country)}})}(),function(){"use strict";wocdb.Runners=Backbone.Collection.extend({initialize:function(){wocdb.dispatcher.on("change:person",this.getPerson,this),this.reset(wocdb.config.bootstrapRunners),0<this.length?(this.personid=this.models[0].personid,this.type="person"):(this.type="person",this.personid="gbr")},url:function(){return wocdb.config.url+"runners/"+this.type+"/"+this.country},model:wocdb.Runner,getRunnersByCountry:function(t,e){this.country=e,this.type=t,wocdb.router.navigate("runners/"+this.type+"/"+this.country),this.fetch()}})}(),function(){"use strict";wocdb.RunnersView=Backbone.View.extend({el:"#country-page",events:{"click #country-table tbody tr":"selectPerson","click #countries li":"selectCountry"},initialize:function(){var t;this.listenTo(this.collection,"update",this.render),wocdb.dispatcher.on("startup:runners",this.render,this),t=wocdb.countries.getCountriesDropdown(""),this.$("#countries").empty().html(t)},render:function(){this.countryTable&&this.countryTable.destroy(),this.$("#country-header-text").empty().html("Runners for "+this.collection.models[0].attributes.country),this.$("#dropdown-country").empty().html(this.collection.models[0].attributes.country+' <span class="caret">'),this.countryTable=$("#country-table").empty().DataTable({data:this.collection.models,columns:[{data:function(t){return t.get("name")},title:"Name",width:"20%"},{data:function(t){return t.get("country")},title:"Country"},{data:function(t){return"<img src='"+t.get("flag")+"'>"},title:""},{data:function(t){return t.get("personid")},title:"Personid"},{data:function(t){return t.get("nameid")},title:"Nameid"},{data:function(t){return t.get("woc")},title:"WOCs"},{data:function(t){return t.get("wocraces")},title:"WOC races"},{data:function(t){return t.get("jwoc")},title:"JWOCs"},{data:function(t){return t.get("jwocraces")},title:"JWOC races"}],createdRow:function(t,e){$(t).attr("plainname",e.attributes.plainname)},lengthMenu:[[20,50,100,-1],[20,50,100,"All"]],order:[0,"asc"],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[1,3,4,5,6,7,8]}]})},selectPerson:function(t){wocdb.dispatcher.trigger("display:page","person-page"),t=$(t.currentTarget).attr("plainname"),wocdb.dispatcher.trigger("change:person",t)},selectCountry:function(t){t=$(t.currentTarget).attr("country").toLowerCase();this.collection.getRunnersByCountry("person",t)}})}(),function(){"use strict";wocdb.Best=Backbone.Model.extend({initialize:function(){this.attributes.flag=wocdb.countries.getFlagFile(this.attributes.country),this.attributes.numericPosition=this.attributes.position,this.attributes.position<4&&(this.attributes.position='<img src="'+wocdb.config.url+"img/"+this.attributes.position+'.svg">'),this.attributes.percentdown=parseFloat(this.attributes.percentdown).toFixed(1),this.attributes.gender=this.attributes.class}})}(),function(){"use strict";wocdb.BestList=Backbone.Collection.extend({initialize:function(){wocdb.dispatcher.on("change:best",this.getBest,this),this.reset(wocdb.config.bootstrapBestList)},url:function(){return wocdb.config.url+"best/"+this.country+"/"+this.type+"/"+this.gender+"/"+this.race},model:wocdb.Best,getBest:function(t){this.country=t.country,this.type=t.type,this.gender=t.gender,this.race=t.race,wocdb.router.navigate("best/"+this.country+"/"+this.type+"/"+this.gender+"/"+this.race),this.fetch()}})}(),function(){"use strict";wocdb.BestView=Backbone.View.extend({el:"#best-page",events:{"click #best-table tbody tr":"selectPerson","click #countries li":"selectCountry","click #races li":"selectRace","click #classes li":"selectClass","click #types li":"selectType","click #best-submit":"getNewResults"},initialize:function(){var t;this.listenTo(this.collection,"update",this.render),wocdb.dispatcher.on("startup:best",this.render,this),t=wocdb.countries.getCountriesDropdown("<li country='all'><a>All countries</a></li>"),this.$("#countries").empty().html(t),t=wocdb.utils.getRacesDropdown(""),this.$("#races").empty().html(t),t=wocdb.utils.getTypesDropdown(""),this.$("#types").empty().html(t),t=wocdb.utils.getClassesDropdown(""),this.$("#classes").empty().html(t)},initializeFromURL:function(){var t=document.URL.split("/");5<t.length&&(this.setCountry(t[t.length-4]),this.setType(t[t.length-3]),this.setClass(t[t.length-2]),this.setRace(t[t.length-1]))},render:function(){this.initializeFromURL(),this.bestTable&&this.bestTable.destroy(),this.renderHeader(),this.bestTable=$("#best-table").empty().DataTable({data:this.collection.models,columns:[{data:function(t){return t.get("name")},title:"Name",width:"20%"},{data:function(t){return t.get("country")},title:"Country"},{data:function(t){return"<img src='"+t.get("flag")+"'>"},title:""},{data:function(t){return t.get("numericPosition")},title:"Position",render:function(t,e){if("display"===e){if(t<4)return'<img src="'+wocdb.config.url+"img/"+t+'.svg">';if(999===t)return"-";if(998===t)return"nc"}return t}},{data:function(t){return t.get("year")},title:"Year"},{data:function(t){return t.get("venue")},title:"Venue"},{data:{_:function(t){return t.get("time")},sort:function(t){return parseInt(t.get("seconds"),10)}},title:"Time",type:"num"},{data:function(t){return t.get("percentdown")},title:"% down"}],createdRow:function(t,e){$(t).attr("plainname",e.attributes.plainname)},lengthMenu:[[20,50,100,-1],[20,50,100,"All"]],order:[1,"asc"],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[1,2,3,4,6,7]}]})},renderHeader:function(){var t="all"===this.country?"Best result by Country for "+this.type.toUpperCase()+" : "+wocdb.utils.capitalise(this.gender)+" : "+wocdb.utils.capitalise(this.race):"Best results for "+this.type.toUpperCase()+" : "+wocdb.utils.capitalise(this.gender)+" : "+wocdb.utils.capitalise(this.race)+" : "+wocdb.countries.getName(this.country);this.$("#best-header-text").empty().html(t)},getNewResults:function(){wocdb.dispatcher.trigger("change:best",{country:this.country,type:this.type,gender:this.gender,race:this.race})},selectPerson:function(t){wocdb.dispatcher.trigger("display:page","person-page"),t=$(t.currentTarget).attr("plainname"),wocdb.dispatcher.trigger("change:person",t)},selectClass:function(t){this.setClass($(t.currentTarget).attr("class"))},setClass:function(t){this.gender=t.toLowerCase(),this.$("#dropdown-class").empty().html(wocdb.utils.capitalise(this.gender)+'<span class="caret">')},selectType:function(t){this.setType($(t.currentTarget).attr("type"))},setType:function(t){this.type=t.toLowerCase(),this.$("#dropdown-type").empty().html(this.type.toUpperCase()+'<span class="caret">')},selectRace:function(t){this.setRace($(t.currentTarget).attr("race"))},setRace:function(t){this.race=t.toLowerCase(),this.$("#dropdown-race").empty().html(wocdb.utils.capitalise(this.race)+'<span class="caret">')},selectCountry:function(t){this.setCountry($(t.currentTarget).attr("country"))},setCountry:function(t){this.country=t.toLowerCase(),t="all"===this.country?"All countries":this.country.toUpperCase(),this.$("#dropdown-country").empty().html(t+'<span class="caret">')}})}(),function(){"use strict";wocdb.Country=Backbone.Model.extend({}),wocdb.Countries=Backbone.Collection.extend({model:wocdb.Country,getCountriesDropdown:function(t){return _.reduce(this.models,this.createCountryDropdownHTML,t)},createCountryDropdownHTML:function(t,e){return t+"<li country='"+e.attributes.abbr+"'><a>"+e.attributes.abbr+" ("+e.attributes.country+")</a></li>"},getName:function(t){t=this.findWhere({abbr:t.toUpperCase()});return t?t.attributes.country:""},getFlagFile:function(t){var e="xx",t=this.findWhere({abbr:t});return t&&(e=t.attributes.code),wocdb.config.url+"img/"+e+".png"}})}(),function(){"use strict";wocdb.Medal=Backbone.Model.extend({initialize:function(){this.attributes.flag=wocdb.countries.getFlagFile(this.attributes.country),this.attributes.numericPosition=this.attributes.position,this.attributes.position<4&&(this.attributes.position='<img src="'+wocdb.config.url+"img/"+this.attributes.position+'.svg">')}})}(),function(){"use strict";wocdb.Medals=Backbone.Collection.extend({initialize:function(){wocdb.dispatcher.on("change:medals",this.getMedals,this),this.reset(wocdb.config.bootstrapMedals)},url:function(){return wocdb.config.url+"medals/"+this.group+"/"+this.type+"/"+this.gender+"/"+this.race},model:wocdb.Medal,getMedals:function(t){this.group=t.group,this.type=t.type,this.gender=t.gender,this.race=t.race,wocdb.router.navigate("medals/"+this.group+"/"+this.type+"/"+this.gender+"/"+this.race),this.fetch({reset:!0})},getMedalCount:function(){var t={G:0,S:0,B:0,relayids:[]};return(t=_.reduce(this.models,function(t,e){var i=!1,s=parseInt(e.attributes.numericPosition,10);return s<4&&(3<parseInt(e.attributes.final,10)?(e=parseInt(e.attributes.raceid,10),-1===_.indexOf(t.relayids,e)&&(t.relayids.push(e),i=!0)):i=!0),i&&(1===s?t.G+=1:2===s?t.S+=1:t.B+=1),t},t)).total=t.G+t.S+t.B,t}})}(),function(){"use strict";wocdb.MedalsView=Backbone.View.extend({el:"#medal-page",events:{"click #medal-table tbody tr":"selectFromTable","click #groups li":"selectGroup","click #races li":"selectRace","click #classes li":"selectClass","click #types li":"selectType","click #medal-submit":"getNewResults"},initialize:function(){var t;this.listenTo(this.collection,"sync",this.render),this.listenTo(this.collection,"reset",this.render),wocdb.dispatcher.on("startup:medal",this.render,this),t=wocdb.utils.getGroupByDropdown(""),this.$("#groups").empty().html(t),t=wocdb.utils.getRacesDropdown("<li race='all'><a>All races</a></li>"),this.$("#races").empty().html(t),t=wocdb.utils.getTypesDropdown("<li type='all'><a>WOC and JWOC</a></li>"),this.$("#types").empty().html(t),t=wocdb.utils.getClassesDropdown("<li class='all'><a>All classes</a></li>"),this.$("#classes").empty().html(t)},initializeFromURL:function(){var t=document.URL.split("/");5<t.length&&(this.setGroup(t[t.length-4]),this.setType(t[t.length-3]),this.setClass(t[t.length-2]),this.setRace(t[t.length-1]))},render:function(){this.initializeFromURL(),this.medalTable&&this.medalTable.destroy(),this.renderHeader(),"person"===this.group||"country"===this.group?this.renderPersonCountryTable():this.renderMedallistTable()},renderHeader:function(){var t="person"===this.group||"country"===this.group?"Medal table by person for"+this.getHeaderText():"Medallists for "+wocdb.countries.getName(this.group)+this.getHeaderText()+this.getMedalCount();this.$("#medal-header-text").empty().html(t)},getHeaderText:function(){var t=": ";return"all"===this.type?t+="WOC and JWOC : ":t+=this.type.toUpperCase()+" : ","all"===this.gender?t+="All classes : ":t+=wocdb.utils.capitalise(this.gender)+" : ","all"===this.race?t+="All races.  ":t+=wocdb.utils.capitalise(this.race)+".  ",t},getMedalCount:function(){var t=this.collection.getMedalCount();return"Gold: "+t.G+" : Silver: "+t.S+" : Bronze: "+t.B+": Total: "+t.total+"."},renderPersonCountryTable:function(){var i=this;this.medalTable=$("#medal-table").empty().DataTable({data:this.collection.models,columns:[{data:function(t){return t.get("name")?t.get("name"):wocdb.countries.getName(t.get("country"))},title:"Name",width:"20%"},{data:function(t){return t.get("country")},title:"Country"},{data:function(t){return"<img src='"+t.get("flag")+"'>"},title:""},{data:function(t){return t.get("G")},title:"Gold"},{data:function(t){return t.get("S")},title:"Silver"},{data:function(t){return t.get("B")},title:"Bronze"},{data:function(t){return t.get("total")},title:"Total"},{data:function(t){return t.get("fromYear")},title:"From"},{data:function(t){return t.get("toYear")},title:"To"}],createdRow:function(t,e){"person"===i.group?$(t).attr("plainname",e.attributes.plainname):$(t).attr("country",e.attributes.country.toLowerCase())},lengthMenu:[[20,50,100,-1],[20,50,100,"All"]],order:[[6,"desc"],[3,"desc"],[4,"desc"],[5,"desc"]],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[1,2,3,4,5,6,7,8]}]})},renderMedallistTable:function(){this.medalTable=$("#medal-table").empty().DataTable({data:this.collection.models,columns:[{data:function(t){return t.get("name")},title:"Name",width:"20%"},{data:function(t){return t.get("country")},title:"Country"},{data:function(t){return"<img src='"+t.get("flag")+"'>"},title:""},{data:function(t){return t.get("numericPosition")},title:"Position",render:function(t,e){if("display"===e){if(t<4)return'<img src="'+wocdb.config.url+"img/"+t+'.svg">';if(999===t)return"-";if(998===t)return"nc"}return t}},{data:function(t){return t.get("year")},title:"Year"},{data:function(t){return wocdb.utils.getType(t.get("wocid"))},title:"Event"},{data:function(t){return wocdb.utils.getVenue(t.get("wocid"))},title:"Venue"},{data:function(t){return t.get("race")},title:"Race"},{data:{_:function(t){return t.get("time")},sort:function(t){return parseInt(t.get("seconds"),10)}},title:"Time",type:"num"}],createdRow:function(t,e){$(t).attr("plainname",e.attributes.plainname)},lengthMenu:[[20,50,100,-1],[20,50,100,"All"]],order:[[3,"asc"],[4,"desc"],[6,"asc"]],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[1,2,3,4,5,7,8]}]})},getNewResults:function(){wocdb.dispatcher.trigger("change:medals",{group:this.group,type:this.type,gender:this.gender,race:this.race})},selectFromTable:function(t){"country"===this.group?(this.group=$(t.currentTarget).attr("country"),wocdb.dispatcher.trigger("change:medals",{group:this.group,type:this.type,gender:this.gender,race:this.race})):(wocdb.dispatcher.trigger("display:page","person-page"),t=$(t.currentTarget).attr("plainname"),wocdb.dispatcher.trigger("change:person",t))},selectClass:function(t){this.setClass($(t.currentTarget).attr("class"))},setClass:function(t){var e="all"===t?"All classes":wocdb.utils.capitalise(t);this.$("#dropdown-class").empty().html(e+'<span class="caret">'),this.gender=t.toLowerCase()},selectType:function(t){this.setType($(t.currentTarget).attr("type"))},setType:function(t){var e="all"===t?"WOC and JWOC":t.toUpperCase();this.$("#dropdown-type").empty().html(e+'<span class="caret">'),this.type=t.toLowerCase()},selectRace:function(t){this.setRace($(t.currentTarget).attr("race"))},setRace:function(t){t="all"===(this.race=t)?"All races":wocdb.utils.capitalise(t);this.$("#dropdown-race").empty().html(t+'<span class="caret">')},selectGroup:function(t){this.setGroup($(t.currentTarget).attr("country"))},setGroup:function(t){this.group=t.toLowerCase(),t="person"===t?"By person":"country"===t?"By country":t.toUpperCase(),this.$("#dropdown-group").empty().html(t+'<span class="caret">')}})}();