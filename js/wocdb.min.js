// Version 0.2.0 2015-07-30T20:35:06;
var wocdb=function(a,b){"use strict";function c(){var a,b,c,d,e;return wocdb.router=new wocdb.WocdbRouter,wocdb.utils.hijackLinks(),wocdb.countries=new wocdb.Countries(wocdb.config.countrydata),wocdb.dispatcher=_.clone(Backbone.Events),wocdb.races=new wocdb.Races,wocdb.wocs=new wocdb.Wocs,wocdb.raceResult=new wocdb.RaceResult,wocdb.person=new wocdb.Person,wocdb.runners=new wocdb.Runners,wocdb.bestlist=new wocdb.BestList,wocdb.medals=new wocdb.Medals,wocdb.activeWOC=new wocdb.ActiveWOC,wocdb.masterView=new wocdb.MasterView,wocdb.activeWOCView=new wocdb.ActiveWOCView({model:wocdb.activeWOC}),wocdb.activeResultView=new wocdb.RaceResultView({collection:wocdb.raceResult}),wocdb.activeResultHeaderView=new wocdb.RaceResultHeaderView({collection:wocdb.raceResult}),wocdb.raceMenuView=new wocdb.RaceMenuView({model:wocdb.activeWOC}),wocdb.runnersView=new wocdb.RunnersView({collection:wocdb.runners}),wocdb.bestView=new wocdb.BestView({collection:wocdb.bestlist}),wocdb.medalView=new wocdb.MedalsView({collection:wocdb.medals}),wocdb.personView=new wocdb.PersonView({collection:wocdb.person}),wocdb.wocDbView=new wocdb.WOCDBView({collection:wocdb.wocs}),Backbone.history.start({pushState:!0,root:"/wocdb",silent:!0}),wocdb.config.bootstrapRaceResult?(wocdb.dispatcher.trigger("display:page","single-woc-page"),b=wocdb.utils.getType(parseInt(wocdb.config.bootstrapRaceResult[0].wocid,10)),a=parseInt(wocdb.config.bootstrapRaceResult[0].year,10),c=parseInt(wocdb.config.bootstrapRaceResult[0].raceid,10),void wocdb.dispatcher.trigger("startup:race",{type:b,year:a,raceid:c})):wocdb.config.bootstrapPerson?void(wocdb.config.bootstrapPerson.length&&(wocdb.dispatcher.trigger("display:page","person-page"),d=wocdb.config.bootstrapPerson[0].plainname,wocdb.dispatcher.trigger("startup:person",d))):wocdb.config.bootstrapRunners?(wocdb.dispatcher.trigger("display:page","country-page"),e=parseInt(wocdb.config.bootstrapRunners[0].country,10),void wocdb.dispatcher.trigger("startup:runners",{type:"person",country:e})):wocdb.config.bootstrapBestList?(wocdb.dispatcher.trigger("display:page","best-page"),void wocdb.dispatcher.trigger("startup:best")):wocdb.config.bootstrapMedals?(wocdb.dispatcher.trigger("display:page","medal-page"),void wocdb.dispatcher.trigger("startup:medal")):void wocdb.dispatcher.trigger("display:page","all-wocs-page")}return{init:c}}(window,window.jQuery);!function(){"use strict";wocdb.ActiveWOC=Backbone.Model.extend({initialize:function(){wocdb.dispatcher.on("change:activeWOC",this.setActiveWOC,this)},setActiveWOC:function(a){this.set(a)}})}(),function(){"use strict";wocdb.Woc=Backbone.Model.extend({initialize:function(){this.attributes.type="W"===this.attributes.type?"WOC":"JWOC",this.attributes.raceids=this.attributes.raceids.split(",").map(function(a){return parseInt(a,10)}),this.attributes.classes=this.attributes.classes.split(","),this.attributes.races=this.attributes.races.split(",")}})}(),function(){"use strict";wocdb.Race=Backbone.Model.extend({initialize:function(){this.set("raceLowerCase",this.attributes.race.toLowerCase()),this.set("genderLowerCase",this.attributes.gender.toLowerCase())}})}(),function(){"use strict";wocdb.Result=Backbone.Model.extend({initialize:function(){this.attributes.flag=wocdb.countries.getFlagFile(this.attributes.country),this.attributes.venue=wocdb.utils.getVenue(this.attributes.wocid),this.attributes.numericPosition=this.attributes.position,this.attributes["final"]>0&&this.attributes.position<4&&(this.attributes.position='<img src="'+wocdb.config.url+"img/"+this.attributes.position+'.svg">'),this.attributes.percentdown=this.attributes.percentdown?parseFloat(this.attributes.percentdown).toFixed(1):"",this.attributes.gender=this.attributes["class"]}})}(),function(){"use strict";wocdb.Wocs=Backbone.Collection.extend({initialize:function(){this.activeWOCIndex=null,wocdb.dispatcher.on("click:showWOCID",this.setActiveWOCID,this),wocdb.dispatcher.on("click:showNextWOC",this.showNextWOC,this),wocdb.dispatcher.on("click:showPreviousWOC",this.showPreviousWOC,this),wocdb.dispatcher.on("startup:race",this.setActiveWOCAtStart,this),this.reset(wocdb.config.bootstrapWocs),this.createRaceCollection()},model:wocdb.Woc,setActiveWOCID:function(a){var b,c;b=this.findWhere({id:a.wocid}),this.activeWocIndex=this.indexOf(b),c=this.models[this.activeWocIndex].attributes,c.startUpRaceID=a.raceid,wocdb.dispatcher.trigger("change:activeWOC",c)},setActiveWOCAtStart:function(a){var b,c;b=this.findWhere({type:a.type,year:a.year}),this.activeWocIndex=this.indexOf(b),c=this.models[this.activeWocIndex].attributes,c.startUpRaceID=a.raceid,wocdb.dispatcher.trigger("change:activeWOC",c)},setActiveWOCIndex:function(a){var b;this.activeWOCIndex=a,b=this.models[a].attributes,wocdb.dispatcher.trigger("change:activeWOC",b)},showPreviousWOC:function(){var a;a=this.activeWOCIndex+1,a>=this.models.length&&(a=0),this.setActiveWOCIndex(a)},showNextWOC:function(){var a;a=this.activeWOCIndex-1,0>a&&(a=this.models.length-1),this.setActiveWOCIndex(a)},createRaceCollection:function(){var a,b,c,d;for(wocdb.races.reset(),c=0;c<this.models.length;c+=1)for(b=this.models[c].attributes,d=0;d<b.raceids.length;d+=1)a={year:b.year,type:b.type,wocid:b.id,gender:b.classes[d],raceid:b.raceids[d],race:b.races[d]},wocdb.races.add(a)}})}(),function(){"use strict";wocdb.Races=Backbone.Collection.extend({model:wocdb.Race,getRaceInfo:function(a){var b;return b=this.findWhere({raceid:a}),b.attributes},getRaceID:function(a,b,c,d){var e;return e=this.findWhere({type:a,year:parseInt(b,10),genderLowerCase:c,raceLowerCase:d}),e?e.attributes.raceid:0}})}(),function(){"use strict";wocdb.RaceResult=Backbone.Collection.extend({initialize:function(){wocdb.dispatcher.on("change:activeWOC",this.setRaceAtWOC,this),wocdb.dispatcher.on("click:showNextRaceAtWOC",this.getNextRaceAtWOC,this),wocdb.dispatcher.on("click:showPreviousRaceAtWOC",this.getPreviousRaceAtWOC,this),this.reset(wocdb.config.bootstrapRaceResult),this.listenTo(this,"update",this.announceNewRaceID),this.raceIndex=null,this.active={}},url:function(){return wocdb.config.url+this.active.type.toLowerCase()+"/"+this.active.year+"/"+this.active.classes[this.raceIndex].toLowerCase()+"/"+this.active.races[this.raceIndex].toLowerCase()},model:wocdb.Result,announceNewRaceID:function(){wocdb.router.navigate(this.active.type.toLowerCase()+"/"+this.active.year+"/"+this.active.classes[this.raceIndex].toLowerCase()+"/"+this.active.races[this.raceIndex].toLowerCase()),wocdb.dispatcher.trigger("change:raceid",this.active.raceids[this.raceIndex])},setRaceAtWOC:function(a){this.raceIndex=0,this.active=a,a.startUpRaceID&&(this.raceIndex=_.indexOf(a.raceids,a.startUpRaceID),-1===this.raceIndex&&(this.raceIndex=0),this.announceNewRaceID()),this.length>0?this.models[0].raceid!==this.active.raceids[this.raceIndex]&&this.loadRace():this.loadRace()},getPreviousRaceAtWOC:function(){this.raceIndex-=1,this.raceIndex<0&&(this.raceIndex=this.active.races.length-1),this.loadRace()},getNextRaceAtWOC:function(){this.raceIndex+=1,this.raceIndex>=this.active.races.length&&(this.raceIndex=0),this.loadRace()},getResultByRaceID:function(a){this.raceIndex=_.indexOf(this.active.raceids,a),-1===this.raceIndex&&(this.raceIndex=0),this.loadRace()},loadRace:function(){this.reset(),this.fetch()}})}(),function(){"use strict";wocdb.ActiveWOCView=Backbone.View.extend({el:"#woc-summary-table",events:{"click #next-woc":"showNextWOC","click #prev-woc":"showPreviousWOC"},summaryTemplate:_.template($("#woc-summary-tmpl").html()),initialize:function(){this.listenTo(this.model,"change",this.render)},showNextWOC:function(){wocdb.dispatcher.trigger("click:showNextWOC")},showPreviousWOC:function(){wocdb.dispatcher.trigger("click:showPreviousWOC")},render:function(){return this.$el.html(this.summaryTemplate(this.model.attributes)),this}})}(),function(){"use strict";wocdb.WOCDBView=Backbone.View.extend({el:"#all-wocs-page",events:{"click #wocs-table tbody tr":"selectWOC"},initialize:function(){this.listenTo(this.collection,"reset",this.render),this.render()},render:function(){this.wocsTable=$("#wocs-table").DataTable({data:this.collection.models,columns:[{data:function(a){return a.get("id")},visible:!1},{data:function(a){return a.get("year")},title:"Year"},{data:function(a){return a.get("type")},title:"Type"},{data:function(a){return a.get("country")},title:"Country"},{data:function(a){return a.get("location")},title:"Location"},{data:function(a){return a.get("dates")},title:"Dates"},{data:function(a){return a.get("countries")},title:"Countries"},{data:function(a){return a.get("runners")},title:"Runners"}],createdRow:function(a,b,c){$(a).attr("id",c)},lengthMenu:[[10,20,-1],[10,20,"All"]],order:[[1,"desc"],[2,"desc"]],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[1,2,6,7]}]})},selectWOC:function(a){var b;wocdb.dispatcher.trigger("display:page","single-woc-page"),b=parseInt(a.currentTarget.id,10),this.collection.setActiveWOCIndex(b)}})}(),function(){"use strict";wocdb.ResultView=Backbone.View.extend({model:wocdb.Result,tagName:"tr",template:_.template($("#race-result-tmpl").html()),render:function(){return this.$el.html(this.template(this.model.attributes)).attr("plainname",this.model.attributes.plainname),this}})}(),function(){"use strict";var a={getVenue:function(a){var b;return b=wocdb.wocs.findWhere({id:parseInt(a,10)}),b?b.attributes.country:""},capitalise:function(a){return a?a[0].toUpperCase()+a.substring(1):""},getType:function(a){return parseInt(a,10)<1e3?"WOC":"JWOC"},getGroupByDropdown:function(a){var b;return b=_.reduce([{text:"By person",value:"person"},{text:"By country",value:"country"}],this.createGroupByDropdownHTML,a),b=wocdb.countries.getCountriesDropdown(b)},createGroupByDropdownHTML:function(a,b){return a+"<li country='"+b.value+"'><a>"+b.text+"</a></li>"},getTypesDropdown:function(a){var b;return b=_.reduce([{text:"WOC",value:"woc"},{text:"JWOC",value:"jwoc"}],this.createTypeDropdownHTML,a)},createTypeDropdownHTML:function(a,b){return a+"<li type='"+b.value+"'><a>"+b.text+"</a></li>"},getClassesDropdown:function(a){var b;return b=_.reduce([{text:"Men",value:"men"},{text:"Women",value:"women"},{text:"Mixed",value:"mixed"}],this.createClassDropdownHTML,a)},createClassDropdownHTML:function(a,b){return a+"<li class='"+b.value+"'><a>"+b.text+"</a></li>"},getRacesDropdown:function(a){var b;return b=_.reduce([{text:"Long",value:"long"},{text:"Middle",value:"middle"},{text:"Sprint",value:"sprint"},{text:"Relay",value:"relay"},{text:"Sprint Relay",value:"sprintrelay"}],this.createRaceDropdownHTML,a)},createRaceDropdownHTML:function(a,b){return a+"<li race='"+b.value+"'><a>"+b.text+"</a></li>"},hijackLinks:function(){$(document).on("click","a[href]:not([data-bypass])",function(a){var b,c;b={prop:$(this).prop("href"),attr:$(this).attr("href")},c=location.protocol+"//"+location.host+"/wocdb",b.prop.slice(0,c.length)===c&&(a.preventDefault(),wocdb.router.navigate(b.attr,!0))})}};wocdb.utils=a}(),function(){"use strict";wocdb.PersonView=Backbone.View.extend({el:"#person-page",events:{"click #person-table tbody tr":"selectWOCRace","click #name-submit":"getNewPerson"},headerTemplate:_.template($("#person-header-tmpl").html()),initialize:function(){this.listenTo(this.collection,"update",this.render),wocdb.dispatcher.on("startup:person",this.render,this),this.nameSearch=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:wocdb.config.url+"namesearch/%QUERY",wildcard:"%QUERY"}}),$("#suggest-name .typeahead").typeahead({highlight:!0},{display:"name",limit:20,source:this.nameSearch}).bind("typeahead:selected",function(a,b){$(this).attr("plainname",b.plainname)})},render:function(){this.personTable&&this.personTable.destroy(),this.$("#person-header").empty().html(this.headerTemplate(this.collection.models[0].attributes)),this.personTable=$("#person-table").empty().DataTable({data:this.collection.models,paging:!1,info:!1,columns:[{data:function(a){return a.get("year")},title:"Year"},{data:function(a){return wocdb.utils.getType(a.get("wocid"))},title:"Event"},{data:function(a){return a.get("venue")},title:"Venue"},{data:function(a){return a.get("class")},title:"Class"},{data:function(a){return a.get("race")},title:"Race"},{data:function(a){return a.get("numericPosition")},title:"Place",render:function(a,b,c){if("display"===b){if(4>a&&c.attributes["final"]>0)return'<img src="'+wocdb.config.url+"img/"+a+'.svg">';if(999===a)return"-"}return a}},{data:function(a){return a.get("name")},title:"Name",width:"20%"},{data:function(a){return a.get("country")},title:"Country"},{data:function(a){return"<img src='"+a.get("flag")+"'>"},title:""},{data:{_:function(a){return a.get("time")},sort:function(a){return parseInt(a.get("seconds"),10)}},title:"Time",type:"num"}],createdRow:function(a,b){$(a).attr("wocid",b.attributes.wocid).attr("raceid",b.attributes.raceid)},order:[[0,"desc"],[1,"desc"]],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[0,1,5,7,9]}]})},getNewPerson:function(){var a;a=$(".typeahead.tt-input").attr("plainname"),wocdb.person.getPerson(a)},selectWOCRace:function(a){var b,c;wocdb.dispatcher.trigger("display:page","single-woc-page"),b=parseInt($(a.currentTarget).attr("wocid"),10),c=parseInt($(a.currentTarget).attr("raceid"),10),wocdb.dispatcher.trigger("click:showWOCID",{wocid:b,raceid:c})}})}(),function(){"use strict";wocdb.RaceResultView=Backbone.View.extend({el:"#result-table",events:{"click tr":"selectPerson"},initialize:function(){this.listenTo(this.collection,"update",this.render),wocdb.dispatcher.on("startup:race",this.render,this)},render:function(){var a,b;if(this.$el.empty().html("<thead><th class='center-text'>Pos</th><th>Name</th><th>Country</th><th></th><th class='center-text'>Time</th><th class='center-text'>% down</th></thead>"),this.collection.length>0)for(a=0;a<this.collection.length;a+=1)b=new wocdb.ResultView({model:this.collection.at(a)}),this.$el.append(b.$el),b.render();else this.$el.append("No records found.");return this.delegateEvents(),this},selectPerson:function(a){var b;wocdb.dispatcher.trigger("display:page","person-page"),b=$(a.currentTarget).attr("plainname"),wocdb.dispatcher.trigger("change:person",b)}})}(),function(){"use strict";wocdb.RaceResultHeaderView=Backbone.View.extend({el:"#race-result-header",events:{"click #next-race-at-woc":"showNextRace","click #prev-race-at-woc":"showPreviousRace"},initialize:function(){this.listenTo(this.collection,"update",this.render),wocdb.dispatcher.on("startup:race",this.render,this)},template:_.template($("#race-header-tmpl").html()),render:function(){var a;return this.collection.length&&(a=this.collection.models[0].attributes,document.title=wocdb.utils.getType(a.wocid)+" "+a.year+" "+a["class"]+" "+a.race,$("#race-result-header-text").html(this.template(a))),this},showNextRace:function(){wocdb.dispatcher.trigger("click:showNextRaceAtWOC")},showPreviousRace:function(){wocdb.dispatcher.trigger("click:showPreviousRaceAtWOC")}})}(),function(){"use strict";wocdb.RaceMenuView=Backbone.View.extend({el:"#race-nav-list",events:{},menuTemplate:_.template($("#race-menu-tmpl").html()),initialize:function(){this.listenTo(this.model,"change",this.render),wocdb.dispatcher.on("change:raceid",this.setNewRaceID,this),this.oldRaceID=null},render:function(){var a,b;for(b=this.model.attributes,this.$el.empty(),a=0;a<b.races.length;a+=1)this.$el.append(this.menuTemplate({type:b.type,year:b.year,gender:b.classes[a],race:b.races[a],raceid:b.raceids[a]}));return this.oldRaceID&&this.$("#"+this.oldRaceID).addClass("active"),this},setNewRaceID:function(a){this.oldRaceID&&this.$("#"+this.oldRaceID).removeClass("active"),this.$("#"+a).addClass("active"),this.oldRaceID=a}})}(),function(){"use strict";wocdb.WocdbRouter=Backbone.Router.extend({routes:{wocdb:"showAllWocs","woc/:year/:gender/:race":"getWOCResult","jwoc/:year/:gender/:race":"getJWOCResult","person/:person":"getPerson","runners/:type/:country":"getRunnersByCountry","medals/:group/:type/:class/:race":"getMedals","best/:country/:type/:class/:race":"getBestResults",person:"nameSearch","*other":"showAllWocs"},nameSearch:function(){wocdb.person.searchName(),wocdb.dispatcher.trigger("display:page","person-page")},getBestResults:function(a,b,c,d){wocdb.bestlist.getBest({country:a,type:b,gender:c,race:d}),wocdb.dispatcher.trigger("display:page","best-page")},getMedals:function(a,b,c,d){wocdb.medals.getMedals({group:a,type:b,gender:c,race:d}),wocdb.dispatcher.trigger("display:page","medal-page")},getPerson:function(a){wocdb.person.getPerson(a),wocdb.dispatcher.trigger("display:page","person-page")},getRunnersByCountry:function(a,b){wocdb.runners.getRunnersByCountry(a,b),wocdb.dispatcher.trigger("display:page","country-page")},getWOCResult:function(a,b,c){this.getResult("WOC",a,b,c)},getJWOCResult:function(a,b,c){this.getResult("JWOC",a,b,c)},getResult:function(a,b,c,d){var e;wocdb.dispatcher.trigger("display:page","single-woc-page"),e=wocdb.races.getRaceID(a,b,c,d),wocdb.raceResult.getResultByRaceID(e)},showAllWocs:function(){document.title="Maprunner WOC Database",wocdb.dispatcher.trigger("display:page","all-wocs-page")}})}(),function(){"use strict";wocdb.Person=Backbone.Collection.extend({initialize:function(){wocdb.dispatcher.on("change:person",this.getPerson,this),this.reset(wocdb.config.bootstrapPerson),this.length>0?this.personid=this.models[0].personid:this.personid=null},url:function(){return wocdb.config.url+"person/"+this.personid},model:wocdb.Result,searchName:function(){this.personid=null},getPerson:function(a){this.personid=a,wocdb.router.navigate("person/"+this.personid),this.fetch()}})}(),function(){"use strict";wocdb.MasterView=Backbone.View.extend({el:"#wocdb-container",pages:["all-wocs-page","single-woc-page","person-page","country-page","best-page","medal-page"],initialize:function(){wocdb.dispatcher.on("display:page",this.setPageVisibility,this)},setPageVisibility:function(a){_.each(this.pages,this.setDisplay,a)},setDisplay:function(a){var b;b=a===this?"block":"none",$("#"+a).css("display",b)}})}(),function(){"use strict";wocdb.Runner=Backbone.Model.extend({initialize:function(){this.attributes.flag=wocdb.countries.getFlagFile(this.attributes.country)}})}(),function(){"use strict";wocdb.Runners=Backbone.Collection.extend({initialize:function(){wocdb.dispatcher.on("change:person",this.getPerson,this),this.reset(wocdb.config.bootstrapRunners),this.length>0?(this.personid=this.models[0].personid,this.type="person"):(this.type="person",this.personid="gbr")},url:function(){return wocdb.config.url+"runners/"+this.type+"/"+this.country},model:wocdb.Runner,getRunnersByCountry:function(a,b){this.country=b,this.type=a,wocdb.router.navigate("runners/"+this.type+"/"+this.country),this.fetch()}})}(),function(){"use strict";wocdb.RunnersView=Backbone.View.extend({el:"#country-page",events:{"click #country-table tbody tr":"selectPerson","click #countries li":"selectCountry"},initialize:function(){var a;this.listenTo(this.collection,"update",this.render),wocdb.dispatcher.on("startup:runners",this.render,this),a=wocdb.countries.getCountriesDropdown(""),this.$("#countries").empty().html(a)},render:function(){this.countryTable&&this.countryTable.destroy(),this.$("#country-header-text").empty().html("Runners for "+this.collection.models[0].attributes.country),this.$("#dropdown-country").empty().html(this.collection.models[0].attributes.country+' <span class="caret">'),this.countryTable=$("#country-table").empty().DataTable({data:this.collection.models,columns:[{data:function(a){return a.get("name")},title:"Name",width:"20%"},{data:function(a){return a.get("country")},title:"Country"},{data:function(a){return"<img src='"+a.get("flag")+"'>"},title:""},{data:function(a){return a.get("personid")},title:"Personid"},{data:function(a){return a.get("nameid")},title:"Nameid"},{data:function(a){return a.get("woc")},title:"WOCs"},{data:function(a){return a.get("wocraces")},title:"WOC races"},{data:function(a){return a.get("jwoc")},title:"JWOCs"},{data:function(a){return a.get("jwocraces")},title:"JWOC races"}],createdRow:function(a,b){$(a).attr("plainname",b.attributes.plainname)},lengthMenu:[[20,50,100,-1],[20,50,100,"All"]],order:[0,"asc"],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[1,3,4,5,6,7,8]}]})},selectPerson:function(a){var b;wocdb.dispatcher.trigger("display:page","person-page"),b=$(a.currentTarget).attr("plainname"),wocdb.dispatcher.trigger("change:person",b)},selectCountry:function(a){var b;b=$(a.currentTarget).attr("country").toLowerCase(),this.collection.getRunnersByCountry("person",b)}})}(),function(){"use strict";wocdb.Best=Backbone.Model.extend({initialize:function(){this.attributes.flag=wocdb.countries.getFlagFile(this.attributes.country),this.attributes.numericPosition=this.attributes.position,this.attributes.position<4&&(this.attributes.position='<img src="'+wocdb.config.url+"img/"+this.attributes.position+'.svg">'),this.attributes.percentdown=parseFloat(this.attributes.percentdown).toFixed(1),this.attributes.gender=this.attributes["class"]}})}(),function(){"use strict";wocdb.BestList=Backbone.Collection.extend({initialize:function(){wocdb.dispatcher.on("change:best",this.getBest,this),this.reset(wocdb.config.bootstrapBestList)},url:function(){return wocdb.config.url+"best/"+this.country+"/"+this.type+"/"+this.gender+"/"+this.race},model:wocdb.Best,getBest:function(a){this.country=a.country,this.type=a.type,this.gender=a.gender,this.race=a.race,wocdb.router.navigate("best/"+this.country+"/"+this.type+"/"+this.gender+"/"+this.race),this.fetch()}})}(),function(){"use strict";wocdb.BestView=Backbone.View.extend({el:"#best-page",events:{"click #best-table tbody tr":"selectPerson","click #countries li":"selectCountry","click #races li":"selectRace","click #classes li":"selectClass","click #types li":"selectType","click #best-submit":"getNewResults"},initialize:function(){var a;this.listenTo(this.collection,"update",this.render),wocdb.dispatcher.on("startup:best",this.render,this),a=wocdb.countries.getCountriesDropdown("<li country='all'><a>All countries</a></li>"),this.$("#countries").empty().html(a),a=wocdb.utils.getRacesDropdown(""),this.$("#races").empty().html(a),a=wocdb.utils.getTypesDropdown(""),this.$("#types").empty().html(a),a=wocdb.utils.getClassesDropdown(""),this.$("#classes").empty().html(a)},initializeFromURL:function(){var a,b;a=document.URL,b=a.split("/"),b.length>5&&(this.setCountry(b[b.length-4]),this.setType(b[b.length-3]),this.setClass(b[b.length-2]),this.setRace(b[b.length-1]))},render:function(){this.initializeFromURL(),this.bestTable&&this.bestTable.destroy(),this.renderHeader(),this.bestTable=$("#best-table").empty().DataTable({data:this.collection.models,columns:[{data:function(a){return a.get("name")},title:"Name",width:"20%"},{data:function(a){return a.get("country")},title:"Country"},{data:function(a){return"<img src='"+a.get("flag")+"'>"},title:""},{data:function(a){return a.get("numericPosition")},title:"Position",render:function(a,b){if("display"===b){if(4>a)return'<img src="'+wocdb.config.url+"img/"+a+'.svg">';if(999===a)return"-"}return a}},{data:function(a){return a.get("year")},title:"Year"},{data:function(a){return a.get("venue")},title:"Venue"},{data:{_:function(a){return a.get("time")},sort:function(a){return parseInt(a.get("seconds"),10)}},title:"Time",type:"num"},{data:function(a){return a.get("percentdown")},title:"% down"}],createdRow:function(a,b){$(a).attr("plainname",b.attributes.plainname)},lengthMenu:[[20,50,100,-1],[20,50,100,"All"]],order:[1,"asc"],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[1,2,3,4,6,7]}]})},renderHeader:function(){var a;a="all"===this.country?"Best result by Country for "+this.type.toUpperCase()+" : "+wocdb.utils.capitalise(this.gender)+" : "+wocdb.utils.capitalise(this.race):"Best results for "+this.type.toUpperCase()+" : "+wocdb.utils.capitalise(this.gender)+" : "+wocdb.utils.capitalise(this.race)+" : "+wocdb.countries.getName(this.country),this.$("#best-header-text").empty().html(a)},getNewResults:function(){wocdb.dispatcher.trigger("change:best",{country:this.country,type:this.type,gender:this.gender,race:this.race})},selectPerson:function(a){var b;wocdb.dispatcher.trigger("display:page","person-page"),b=$(a.currentTarget).attr("plainname"),wocdb.dispatcher.trigger("change:person",b)},selectClass:function(a){this.setClass($(a.currentTarget).attr("class"))},setClass:function(a){this.gender=a.toLowerCase(),this.$("#dropdown-class").empty().html(wocdb.utils.capitalise(this.gender)+'<span class="caret">')},selectType:function(a){this.setType($(a.currentTarget).attr("type"))},setType:function(a){this.type=a.toLowerCase(),this.$("#dropdown-type").empty().html(this.type.toUpperCase()+'<span class="caret">')},selectRace:function(a){this.setRace($(a.currentTarget).attr("race"))},setRace:function(a){this.race=a.toLowerCase(),this.$("#dropdown-race").empty().html(wocdb.utils.capitalise(this.race)+'<span class="caret">')},selectCountry:function(a){this.setCountry($(a.currentTarget).attr("country"))},setCountry:function(a){var b;this.country=a.toLowerCase(),b="all"===this.country?"All countries":this.country.toUpperCase(),this.$("#dropdown-country").empty().html(b+'<span class="caret">')}})}(),function(){"use strict";wocdb.Country=Backbone.Model.extend({}),wocdb.Countries=Backbone.Collection.extend({model:wocdb.Country,getCountriesDropdown:function(a){var b;return b=_.reduce(this.models,this.createCountryDropdownHTML,a)},createCountryDropdownHTML:function(a,b){return a+"<li country='"+b.attributes.abbr+"'><a>"+b.attributes.abbr+" ("+b.attributes.country+")</a></li>"},getName:function(a){var b;return b=this.findWhere({abbr:a.toUpperCase()}),b?b.attributes.country:""},getFlagFile:function(a){var b,c;return c="xx",b=this.findWhere({abbr:a}),b&&(c=b.attributes.code),wocdb.config.url+"img/"+c+".png"}})}(),function(){"use strict";wocdb.Medal=Backbone.Model.extend({initialize:function(){this.attributes.flag=wocdb.countries.getFlagFile(this.attributes.country),this.attributes.numericPosition=this.attributes.position,this.attributes.position<4&&(this.attributes.position='<img src="'+wocdb.config.url+"img/"+this.attributes.position+'.svg">')}})}(),function(){"use strict";wocdb.Medals=Backbone.Collection.extend({initialize:function(){wocdb.dispatcher.on("change:medals",this.getMedals,this),this.reset(wocdb.config.bootstrapMedals)},url:function(){return wocdb.config.url+"medals/"+this.group+"/"+this.type+"/"+this.gender+"/"+this.race},model:wocdb.Medal,getMedals:function(a){this.group=a.group,this.type=a.type,this.gender=a.gender,this.race=a.race,wocdb.router.navigate("medals/"+this.group+"/"+this.type+"/"+this.gender+"/"+this.race),this.fetch({reset:!0})},getMedalCount:function(){var a;return a={G:0,S:0,B:0,relayids:[]},a=_.reduce(this.models,function(a,b){var c,d,e;return e=!1,c=parseInt(b.attributes.numericPosition,10),4>c&&(parseInt(b.attributes["final"],10)>3?(d=parseInt(b.attributes.raceid,10),-1===_.indexOf(a.relayids,d)&&(a.relayids.push(d),e=!0)):e=!0),e&&(1===c?a.G+=1:2===c?a.S+=1:a.B+=1),a},a),a.total=a.G+a.S+a.B,a}})}(),function(){"use strict";wocdb.MedalsView=Backbone.View.extend({el:"#medal-page",events:{"click #medal-table tbody tr":"selectFromTable","click #groups li":"selectGroup","click #races li":"selectRace","click #classes li":"selectClass","click #types li":"selectType","click #medal-submit":"getNewResults"},initialize:function(){var a;this.listenTo(this.collection,"sync",this.render),this.listenTo(this.collection,"reset",this.render),wocdb.dispatcher.on("startup:medal",this.render,this),a=wocdb.utils.getGroupByDropdown(""),this.$("#groups").empty().html(a),a=wocdb.utils.getRacesDropdown("<li race='all'><a>All races</a></li>"),this.$("#races").empty().html(a),a=wocdb.utils.getTypesDropdown("<li type='all'><a>WOC and JWOC</a></li>"),this.$("#types").empty().html(a),a=wocdb.utils.getClassesDropdown("<li class='all'><a>All classes</a></li>"),this.$("#classes").empty().html(a)},initializeFromURL:function(){var a,b;a=document.URL,b=a.split("/"),b.length>5&&(this.setGroup(b[b.length-4]),this.setType(b[b.length-3]),this.setClass(b[b.length-2]),this.setRace(b[b.length-1]))},render:function(){this.initializeFromURL(),this.medalTable&&this.medalTable.destroy(),this.renderHeader(),"person"===this.group||"country"===this.group?this.renderPersonCountryTable():this.renderMedallistTable()},renderHeader:function(){var a;a="person"===this.group||"country"===this.group?"Medal table by person for"+this.getHeaderText():"Medallists for "+wocdb.countries.getName(this.group)+this.getHeaderText()+this.getMedalCount(),this.$("#medal-header-text").empty().html(a)},getHeaderText:function(){var a;return a=": ",a+="all"===this.type?"WOC and JWOC : ":this.type.toUpperCase()+" : ",a+="all"===this.gender?"All classes : ":wocdb.utils.capitalise(this.gender)+" : ",a+="all"===this.race?"All races.  ":wocdb.utils.capitalise(this.race)+".  "},getMedalCount:function(){var a;return a=this.collection.getMedalCount(),"Gold: "+a.G+" : Silver: "+a.S+" : Bronze: "+a.B+": Total: "+a.total+"."},renderPersonCountryTable:function(){var a=this;this.medalTable=$("#medal-table").empty().DataTable({data:this.collection.models,columns:[{data:function(a){return a.get("name")?a.get("name"):wocdb.countries.getName(a.get("country"))},title:"Name",width:"20%"},{data:function(a){return a.get("country")},title:"Country"},{data:function(a){return"<img src='"+a.get("flag")+"'>"},title:""},{data:function(a){return a.get("G")},title:"Gold"},{data:function(a){return a.get("S")},title:"Silver"},{data:function(a){return a.get("B")},title:"Bronze"},{data:function(a){return a.get("total")},title:"Total"}],createdRow:function(b,c){"person"===a.group?$(b).attr("plainname",c.attributes.plainname):$(b).attr("country",c.attributes.country.toLowerCase())},lengthMenu:[[20,50,100,-1],[20,50,100,"All"]],order:[[6,"desc"],[3,"desc"],[4,"desc"],[5,"desc"]],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[1,2,3,4,5,6]}]})},renderMedallistTable:function(){this.medalTable=$("#medal-table").empty().DataTable({data:this.collection.models,columns:[{data:function(a){return a.get("name")},title:"Name",width:"20%"},{data:function(a){return a.get("country")},title:"Country"},{data:function(a){return"<img src='"+a.get("flag")+"'>"},title:""},{data:function(a){return a.get("numericPosition")},title:"Position",render:function(a,b){if("display"===b){if(4>a)return'<img src="'+wocdb.config.url+"img/"+a+'.svg">';if(999===a)return"-"}return a}},{data:function(a){return a.get("year")},title:"Year"},{data:function(a){return wocdb.utils.getType(a.get("wocid"))},title:"Event"},{data:function(a){return wocdb.utils.getVenue(a.get("wocid"))},title:"Venue"},{data:function(a){return a.get("race")},title:"Race"},{data:{_:function(a){return a.get("time")},sort:function(a){return parseInt(a.get("seconds"),10)}},title:"Time",type:"num"}],createdRow:function(a,b){$(a).attr("plainname",b.attributes.plainname)},lengthMenu:[[20,50,100,-1],[20,50,100,"All"]],order:[[3,"asc"],[4,"desc"],[6,"asc"]],autoWidth:!0,searching:!1,columnDefs:[{className:"dt-center",targets:[1,2,3,4,5,7,8]}]})},getNewResults:function(){wocdb.dispatcher.trigger("change:medals",{group:this.group,type:this.type,gender:this.gender,race:this.race})},selectFromTable:function(a){var b;"country"===this.group?(this.group=$(a.currentTarget).attr("country"),wocdb.dispatcher.trigger("change:medals",{group:this.group,type:this.type,gender:this.gender,race:this.race})):(wocdb.dispatcher.trigger("display:page","person-page"),b=$(a.currentTarget).attr("plainname"),wocdb.dispatcher.trigger("change:person",b))},selectClass:function(a){this.setClass($(a.currentTarget).attr("class"))},setClass:function(a){var b;b="all"===a?"All classes":wocdb.utils.capitalise(a),this.$("#dropdown-class").empty().html(b+'<span class="caret">'),this.gender=a.toLowerCase();
},selectType:function(a){this.setType($(a.currentTarget).attr("type"))},setType:function(a){var b;b="all"===a?"WOC and JWOC":a.toUpperCase(),this.$("#dropdown-type").empty().html(b+'<span class="caret">'),this.type=a.toLowerCase()},selectRace:function(a){this.setRace($(a.currentTarget).attr("race"))},setRace:function(a){var b;this.race=a,b="all"===a?"All races":wocdb.utils.capitalise(a),this.$("#dropdown-race").empty().html(b+'<span class="caret">')},selectGroup:function(a){this.setGroup($(a.currentTarget).attr("country"))},setGroup:function(a){var b;this.group=a.toLowerCase(),b="person"===a?"By person":"country"===a?"By country":a.toUpperCase(),this.$("#dropdown-group").empty().html(b+'<span class="caret">')}})}();